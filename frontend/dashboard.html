<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Dashboard</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="base.css">
        <link rel="stylesheet" href="dashboard.css">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Lato:wght@400;700&family=Poppins:wght@400;600&family=Source+Code+Pro:wght@400&display=swap" rel="stylesheet">
        <script src="main.js" defer></script>
    </head>
    <body>
        <header>
            <div class="logo">DUSH</div>
            <div class="nav">
                <a href="index.html">HOME</a>
                <a href="blog.html">BLOG</a>
                <a href="dashboard.html" class="active">DASHBOARD</a>
            </div>
            <div class="social-icons">
                <a href="https://linkedin.com/in/ariane-dushime" class="social-icon" target="_blank" aria-label="LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="https://github.com/dushriane" class="social-icon" target="_blank" aria-label="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <a href="mailto:arianedushime941@gmail.com" class="social-icon" aria-label="Email">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
            <div class="hamburger" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </header>
        
        <div class="mobile-menu" id="mobileMenu">
            <div class="nav">
                <a href="index.html">HOME</a>
                <a href="blog.html">BLOG</a>
                <a href="dashboard.html" class="active">DASHBOARD</a>
            </div>
            <div class="auth-buttons">
                <a href="login.html">Login</a>
                <a href="#">Register</a>
            </div>
            
            <!-- <div class="social-icons">
                <a href="https://linkedin.com/in/ariane-dushime" class="social-icon" target="_blank" aria-label="LinkedIn">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="https://github.com/dushriane" class="social-icon" target="_blank" aria-label="GitHub">
                    <i class="fab fa-github"></i>
                </a>
                <a href="mailto:arianedushime941@gmail.com" class="social-icon" aria-label="Email">
                    <i class="fas fa-envelope"></i>
                </a>
            </div> -->
        </div>

        <main class="dashboard">
            <div class="dashboard-header section">
                <div>
                    <h1 class="dashboard-title">Blog Dashboard</h1>
                    <p>Manage your blog posts and analytics</p>
                </div>
                <div>
                    <!-- implement here so that I can go to the page to create a new post. and also the logout button works -->
                    <button class="new-post-btn" onclick="createNewPost()">+ New Post</button>
                    <button class="logout-btn" onclick="logout()" style="margin-left: 10px; background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Logout</button>
                </div>
            </div>

            <div class="dashboard-stats section">
                <div class="stat-card">
                    <div class="stat-number">5</div>
                    <div class="stat-label">Total Posts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">1.2k</div>
                    <div class="stat-label">Total Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">8</div>
                    <div class="stat-label">Categories</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">95%</div>
                    <div class="stat-label">Engagement Rate</div>
                </div>
            </div>
<!-- these should work right away -->
            <div class="dashboard-filter">
                <span class="filter-label">Filter by Category:</span>
                <div class="dashboard-filter-tags" id="dashboardFilterTags">
                    <button class="dashboard-filter-tag active" data-category="all">All</button>
                    <button class="dashboard-filter-tag" data-category="tech">Tech</button>
                    <button class="dashboard-filter-tag" data-category="life">Life</button>
                    <button class="dashboard-filter-tag" data-category="philosophy">Philosophy</button>
                    <!-- Add more categories as needed -->
                </div>
            </div>
<!-- the posts shouldn't occupy the whole length and should be clickable to go to them directly -->
            <div class="dashboard-posts" id="dashboardPosts">
                <div class="dashboard-post" data-category="tech">
                    <h3>How to Build a Portfolio</h3>
                    <p>Category: Tech</p>
                </div>
                <div class="dashboard-post" data-category="life">
                    <h3>Emotions Feel Good</h3>
                    <p>Category: Life</p>
                </div>
                <div class="dashboard-post" data-category="philosophy">
                    <h3>Building Systems That Last</h3>
                    <p>Category: Philosophy</p>
                </div>
                <!-- Add more posts as needed -->
            </div>

<!-- put these in a side bar like how most dashboards look like -->
            <div class="sidebar section">
                <h3 class="sidebar-title">Quick Actions</h3>
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="createNewPost()">
                        üìù Create New Post
                    </button>
                    <button class="quick-action-btn" onclick="viewAnalytics()">
                        üìä View Analytics
                    </button>
                    <button class="quick-action-btn" onclick="manageCategories()">
                        üè∑Ô∏è Manage Categories
                    </button>
                    <button class="quick-action-btn" onclick="exportData()">
                        üì§ Export Data
                    </button>
                </div>
<!-- rethink if I need this -->
                <h3 class="sidebar-title" style="margin-top: 2rem;">Recent Activity</h3>
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-time">2 hours ago</div>
                        <div class="activity-text">Post "Building Systems That Last" published</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">1 day ago</div>
                        <div class="activity-text">Updated "Emotions feel good" post</div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-time">3 days ago</div>
                        <div class="activity-text">New category "Design" added</div>
                    </div>
                </div>
            </div>
        </main>

        <script>
            // Check authentication on page load
            document.addEventListener('DOMContentLoaded', function() {
                checkAuth();
                loadDashboardData();
            });

            function checkAuth() {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    window.location.href = '/login.html';
                    return;
                }

                // Verify token with server
                fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('user');
                        window.location.href = '/login.html';
                    }
                })
                .catch(error => {
                    console.error('Auth check failed:', error);
                    window.location.href = '/login.html';
                });
            }

            function logout() {
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                window.location.href = '/login.html';
            }

            async function loadDashboardData() {
                try {
                    const token = localStorage.getItem('authToken');
                    
                    // Load stats
                    const statsResponse = await fetch('/api/dashboard/stats', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const stats = await statsResponse.json();
                    
                    // Update stats display
                    document.querySelector('.stat-card:nth-child(1) .stat-number').textContent = stats.totalPosts;
                    document.querySelector('.stat-card:nth-child(2) .stat-number').textContent = stats.totalViews;
                    document.querySelector('.stat-card:nth-child(3) .stat-number').textContent = '8'; // Categories
                    document.querySelector('.stat-card:nth-child(4) .stat-number').textContent = '95%'; // Engagement
                    
                    // Load posts
                    const postsResponse = await fetch('/api/dashboard/posts', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    const postsData = await postsResponse.json();
                    
                    // Update posts display
                    const postsContainer = document.getElementById('dashboardPosts');
                    postsContainer.innerHTML = '';
                    
                    postsData.posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.className = 'dashboard-post';
                        postElement.setAttribute('data-category', post.category.toLowerCase());
                        postElement.innerHTML = `
                            <h3>${post.title}</h3>
                            <p>Category: ${post.category}</p>
                            <p>Status: ${post.published ? 'Published' : 'Draft'}</p>
                            <p>Views: ${post.views}</p>
                        `;
                        postsContainer.appendChild(postElement);
                    });
                    
                } catch (error) {
                    console.error('Error loading dashboard data:', error);
                }
            }

            function createNewPost() {
                alert('New post creation feature coming soon!');
            }

            function openPost(postId) {
                window.location.href = `post-${postId}.html`;
            }

            function viewAnalytics() {
                alert('Analytics dashboard coming soon!');
            }

            function manageCategories() {
                alert('Category management coming soon!');
            }

            function exportData() {
                alert('Data export feature coming soon!');
            }

            function filterPosts() {
                const filter = document.getElementById('categoryFilter').value;
                const posts = document.querySelectorAll('.post-item');
                
                posts.forEach(post => {
                    const category = post.querySelector('.post-item-meta span:nth-child(2)').textContent.toLowerCase();
                    if (filter === 'all' || category === filter) {
                        post.style.display = 'block';
                    } else {
                        post.style.display = 'none';
                    }
                });
            }
        </script>
    </body>
</html>